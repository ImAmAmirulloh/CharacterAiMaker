
<main class="min-h-screen bg-gray-900 text-gray-100 p-4 sm:p-6 lg:p-8">
  <div class="max-w-7xl mx-auto">
    
    <header class="text-center mb-8">
      <div class="inline-flex items-center gap-3 mb-2">
        <svg class="w-10 h-10 text-cyan-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" />
        </svg>
        <h1 class="text-4xl font-bold tracking-tight text-white">Character AI Maker</h1>
      </div>
      <p class="text-lg text-gray-400">Instantly generate rich, creative character profiles with AI.</p>
    </header>

    <div class="bg-gray-800 p-6 rounded-xl shadow-2xl border border-gray-700 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- Image Upload -->
        <div class="flex-shrink-0 md:col-span-1">
            <label for="image-upload" class="cursor-pointer group block bg-gray-700 rounded-lg w-full h-48 border-2 border-dashed border-gray-600 hover:border-cyan-500 transition-colors flex items-center justify-center text-center p-2 relative overflow-hidden">
                @if (imagePreview()) {
                    <img [src]="imagePreview()" alt="Character Reference" class="w-full h-full object-cover rounded-md">
                    <button (click)="removeImage($event)" class="absolute top-1 right-1 bg-red-600/70 hover:bg-red-500 rounded-full p-1 text-white opacity-0 group-hover:opacity-100 transition-opacity z-10">
                        <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                    @if (isAnalyzing()) {
                      <div class="absolute inset-0 bg-black/60 flex items-center justify-center">
                        <svg class="animate-spin h-8 w-8 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                      </div>
                    }
                } @else {
                    <div class="text-gray-400">
                      <svg class="mx-auto h-12 w-12" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                      <span class="mt-2 text-sm block font-medium">Upload Image</span>
                      <span class="text-xs text-gray-500 block">(Optional)</span>
                    </div>
                }
            </label>
            <input id="image-upload" type="file" class="hidden" (change)="onFileSelected($event)" accept="image/png, image/jpeg, image/webp">
        </div>

        <!-- Input and Button -->
        <div class="md:col-span-2 flex flex-col gap-4">
            <textarea 
              [value]="theme()" (input)="updateTheme($event)"
              [placeholder]="isAnalyzing() ? 'Analyzing image...' : 'Enter theme or upload an image for an AI suggestion'"
              [disabled]="isAnalyzing()"
              class="w-full h-28 bg-gray-700 border border-gray-600 text-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-shadow duration-200 resize-y"
            ></textarea>
            <textarea 
              [value]="additionalInstructions()" (input)="updateAdditionalInstructions($event)"
              placeholder="Additional Instructions (Optional, e.g., 'give the character a German accent')"
              [disabled]="isAnalyzing() || isLoading()"
              class="w-full h-20 bg-gray-700 border border-gray-600 text-gray-200 rounded-lg p-4 focus:ring-2 focus:ring-cyan-500 focus:outline-none transition-shadow duration-200 resize-y"
            ></textarea>
            <button 
              (click)="generateCharacter()" 
              [disabled]="isLoading() || !theme() || isAnalyzing()"
              class="bg-cyan-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-cyan-500 disabled:bg-gray-600 disabled:cursor-not-allowed transition-all duration-200 flex items-center justify-center shadow-lg hover:shadow-cyan-500/30">
              @if (isLoading()) {
                <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                  <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span>Generating...</span>
              } @else {
                <span>Generate Character</span>
              }
            </button>
        </div>
      </div>
    </div>
    
    @if (error()) {
      <div class="bg-red-900/50 border border-red-700 text-red-300 p-4 rounded-lg mb-8 text-center">
        <strong>Error:</strong> {{ error() }}
      </div>
    }

    <div class="flex justify-between items-center mb-6 border-b-2 border-gray-700 pb-4">
        <h2 class="text-2xl font-bold text-white">Generated Character Profile</h2>
        @if (character()) {
          <button (click)="downloadCharacterData()" class="bg-gray-700 text-cyan-400 font-semibold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors duration-200 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            <span>Download .txt</span>
          </button>
        }
    </div>

    <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <app-output-card class="lg:col-span-3" title="Title" [isLoading]="isLoading()" [content]="character()?.title" />
      <app-output-card class="lg:col-span-1" title="Name" [isLoading]="isLoading()" [content]="character()?.name" />
      <app-output-card class="lg:col-span-2" title="Description" [isLoading]="isLoading()" [content]="character()?.description" />
      <app-output-card class="lg:col-span-3" title="Persona (JSON)" [isLoading]="isLoading()" [content]="getPersonaString(character())" />
      <app-output-card class="lg:col-span-3" title="First Message" [isLoading]="isLoading()" [content]="character()?.first_message" />
      <app-output-card class="lg:col-span-3" title="Scenario" [isLoading]="isLoading()" [content]="character()?.scenario" />
      <app-output-card class="lg:col-span-3" title="Example Dialogue" [isLoading]="isLoading()" [content]="character()?.example_dialogue" />
      <app-output-card class="lg:col-span-3" title="Image Prompt" [isLoading]="isLoading()" [content]="character()?.image_prompt" />
      <app-output-card class="lg:col-span-1" title="Custom Tags" [isLoading]="isLoading()" [content]="getArrayString(character()?.custom_tags)" />
      <app-output-card class="lg:col-span-2" title="Categories" [isLoading]="isLoading()" [content]="getArrayString(character()?.categories)" />
    </section>
  </div>
</main>
